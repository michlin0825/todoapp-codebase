option_settings:
  aws:elasticbeanstalk:application:environment:
    ASPNETCORE_ENVIRONMENT: Production
  aws:elasticbeanstalk:cloudwatch:logs:
    StreamLogs: true
    DeleteOnTerminate: false
    RetentionInDays: 30

packages:
  yum:
    sqlite: []

files:
  "/opt/elasticbeanstalk/hooks/appdeploy/pre/01_create_db_directory.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      echo "Creating database directory..."
      mkdir -p /var/app/db
      chown -R webapp:webapp /var/app/db
      chmod 775 /var/app/db
      echo "Database directory created and permissions set."

  "/opt/elasticbeanstalk/hooks/appdeploy/post/99_make_db_writable.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      echo "Setting up database file..."
      
      # Create empty database file if it doesn't exist
      if [ ! -f /var/app/db/todoapp.db ]; then
        echo "Creating new database file..."
        touch /var/app/db/todoapp.db
        chown webapp:webapp /var/app/db/todoapp.db
        chmod 664 /var/app/db/todoapp.db
        echo "New database file created."
      else
        echo "Database file already exists."
      fi
      
      # Make sure permissions are correct
      echo "Setting permissions on database file..."
      chown webapp:webapp /var/app/db/todoapp.db
      chmod 664 /var/app/db/todoapp.db
      
      # Log for debugging
      echo "Database file permissions:"
      ls -la /var/app/db/
